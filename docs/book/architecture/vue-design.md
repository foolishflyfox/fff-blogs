---
outline: deep
---

# Vue.js 设计与实现

## 第 1 章 权衡的艺术

在学习框架的时候，应该从全局的角度对框架的设计有清晰的认知，否则很容易被细节困住，看不清全貌。

从范式上来看，视图层框架通常分为命令式和声明式。

jQuery 是典型的命令式框架，特点是**关注过程**，例如将下面的代码：

```js
$("#app") // 获取 div
  .text("hello world") // 设置文本内容
  .on("click", () => {
    alert("ok");
  }); // 绑定点击事件
```

与命令式框架更加关注过程不同，声明式框架更加关注结果，例如：

```vue
<div @click="() => alert('ok')">hello world</div>
```

通常来说，声明式代码的性能不优于命令式代码的性能，但声明式代码的可维护性要强于命令式代码。框架设计者要做的是：在保持可维护性的同时，让性能损失最小化。

声明式代码的更新性能消耗 = 找出差异的性能消耗 + 直接修改的性能消耗。如果我们能最小化“找出差异的性能消耗”，就可以让声明式代码的性能无限接近命令式代码的性能。

虚拟 DOM 就是为了最小化找出差异这一步的性能消耗而出现的。

虚拟 DOM 是如何更新页面的？它需要重新创建 JavaScript 对象（虚拟 DOM 树），然后比较新旧虚拟 DOM，找到变化的元素并更新它。虚拟 DOM 相对于原生 JavaScript 和 innerHTML 而言，心智负担小，可维护性强，并且有不错的性能。

当设计一个框架的时候，我们有三种选择：

- 纯运行时：用户提供一个 UI 的数据结构，框架通过 render 渲染函数将其可视化；
- 运行时+编译时：用户既可以提供 UI 的数据结构，也可以提供类似 HTML 的文本，框架可以将类 HTML 通过 compile 编译函数转换为 UI 的数据结构，再进行渲染
- 纯编译时：在运行前，将用户提供的类 HTML 文本转换为 js 代码，运行时直接执行 js 实现可视化

Svelte 是纯编译时的框架，Vue3 是运行时+编译时的架构，在保持灵活性的基础上尽可能地去优化。
