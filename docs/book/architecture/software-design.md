---
outline: deep
---

# 软件设计: 从专业到卓越

## 前言

**形成团队设计共识**: 软件开发是集体活动。团队如果缺乏设计共识，设计出的代码就不可能易于扩展、易于维护，可能还会在具体的解决方案设计上产生不必要的摩擦。

## 品味篇

优秀代码的特征：

- **外部特征**：是高质量代码应有的外在表现，从结果角度衡量。对这些特征的判断无须深入代码，即使是一个不懂软件的人，也能从外部感知到。
- **内部特征**：体现了代码是否“专业”，从代码的内部质量角度衡量。经验丰富的软件工程师，只需要大致读一下代码，就能感知到代码的大致质量

### 第 1 章 优质代码的外部特征

外部特征可以概括为以下 5 条：

1. 实现了期望的功能
2. 缺陷尽量少
3. 易于理解
4. 易于演进
5. 易于复用

其中前两条与代码外部质量有关，关注当下的效益。后 3 条和代码的演进有关，关注长期的价值。

#### 期望实现

Q：为什么实现期望的功能难？
A：用户真正需要的和用户描述的往往并不一致，经过层层加工，信息更是进一步失真，最终不仅成本大量超出预算，所开发的东西也不能真正满足用户的需要。

开发软件的过程是一个持续建立认知的过程。我们不能寄希望于业务人员一开始就对问题有直达本质的认知，随着开发过程的展开，渐渐地弄明白问题是很正常的。同样，我们也不能寄希望于开发人员一开始就能有直达本质的解决方案，随着开发过程的展开，渐渐地弄明白方案也是正常的。

有价值的软件需要关注的两个方面：

- 加快认知的过程
- 增加设计弹性，在出现问题时能较快调整

**优秀的开发者会关注自己开发的软件的真正价值，而不只是盲目地接收到手的需求。**

优秀的软件工程师往往也是沟通的高手，尊重他人、认真理解对方意图、准确达成一致方面。

如果软件设计得足够好，那么完全可以在用户需求发生变化时随机应变。

#### 缺陷少

关于软件缺陷的两个事实：

- 缺陷不可能完全避免；
- 缺陷带来的影响和发现缺陷的时机密切相关，要规避缺陷造成的影响，最重要的原则是尽量早地发现缺陷；

缺陷并不可怕，真正可怕的是没有能力及时发现缺陷。我们要做的不是要规避缺陷，而是要通过加快反馈，在缺陷造成实质性影响之前，就把它消灭于无形。

缺陷的应对策略：

- 缩短缺陷的发现周期：测试先行
- 降低缺陷的发现成本和修复成本：自动化测试
- 缩小缺陷的影响面：通过把软件划分为更合理的设计单元 ，定义清楚设计单元之间的依赖、接口和契约 ，并采取契约式设计等手段，就可以起到防火墙的效果，从而降低缺陷带来的影响

#### 易于理解

辻算机程序首先是用来给人读的，只是顺便用于机器执行。

高质量的软件设计一定会刻意且安全地隐藏细节，从而提升代码的可理解性。

代码的设计结构应该最大化地降低理解负担、尽量减少阅读代码的必要性。例如，让工程师：

- 能通过阅读 API 声明去理解代码，就不要去阅读 API 是如何实现的;
- 能通过观察代码结构 (如类名、包名、方法名)去理解代码，就不需要去阅读代码的内部实现；
- 能通过阅读直接理解代码，就不需要去阅读文档和注释；

降低代码的复杂性，是提升代码可理解性的关键，和许多编程实践密切相关：

- 更好的命名
- 一致的业务概念
- 更好的结构设计
- 尽量减少不必要的设计元素
- 减少重复
- 增加设计契约和**测试的描述能力**

凡是能真正把他人怎么阅读代码放在心上的软件工程师，即使一开始不具备非常好的设计技巧，随着时间的推移，也能很快学会这些技巧。**心中有他人是非常重要的意识和素养**，一个例子就是结对编程。

#### 易于演进

软件在实现了早期功能之后，并不会停止“生长”，而是会在后续的业务发展中被持续注入新的功能或者放入新的使用场景中。

为演进而设计：

- 良好的设计结构：好的设计，能够把那些似乎藕断丝连的逻辑巧妙地分解开，形成正交的设计，让它们互不影响。正交设计是增强代码演进能力最重要的手段，下面是一些好的设计原则：
  - 观察设计中相关因素的变化频率，把容易变化和不容易变化的部分分开，就能减少变化的影响
  - 根据变化的方向来识别设计对象的职责，这就是面向对象设计中的单一职责原则
  - 开闭原则
- 自动化测试
- 简单设计：要警惕一种可能会伤害到设计演进能力的“前瞻性设计”做法，即为未来所做的“预留设计”，这种错误的设计方式，也被称为过度设计或大规模预先设计

#### 易于复用

软件是信息制品，信息制品的典型特点是复用的边际成本极低。选择合适的复用粒度，定义清晰的设计职责和设计契约并很好地管理依赖，是提升代码复用能力的重要手段。

复用粒度越大，复用价值也就越大，不过复用的机会往往更小。

时至今日，业务模块的复用已经有了更好的理论基础，而且经过了实践的检验，这就是以领域为中心的设计。

可靠的复用必须满足两个条件：

1. 被复用模块的职责必须清晰，这样别人才可以知道该不该复用、能不能复用
2. 被复用模块的实际行为必须和承诺的职责相一致，这样才能被可靠地复用

### 第 2 章 优质代码的内在特征
